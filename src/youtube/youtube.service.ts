import { Injectable, Logger } from '@nestjs/common';
import { IYoutubeOptions } from '@/types/youtube';
import { HttpService } from '@nestjs/axios';
import { ConfigService } from '@nestjs/config';
import { Context } from '@/telegram/telegram.service';
import { catchError, firstValueFrom, of } from 'rxjs';
import { ConversionModule } from '@/conversion/conversion.module';
import { ConversionService } from '@/conversion/conversion.service';

const resData = {
  status: 'OK',
  id: 'acNujJNLO7U',
  title: 'eyedress - jealous (slowed + reverb)',
  lengthSeconds: '143',
  channelTitle: 'cowboycat',
  channelId: 'UCWH1w8zPbnT3TiX9yQ1bO7w',
  description: 'slowed + reverb by cowboycat',
  thumbnail: [
    {
      url: 'https://i.ytimg.com/vi/acNujJNLO7U/default.jpg?sqp=-oaymwEkCHgQWvKriqkDGvABAfgB_gmAAtAFigIMCAAQARg-IBgofzAP&rs=AOn4CLAxk6cwY8dpJdnfDHTN0o2uBV_eXQ',
      width: 120,
      height: 90,
    },
    {
      url: 'https://i.ytimg.com/vi/acNujJNLO7U/mqdefault.jpg?sqp=-oaymwEmCMACELQB8quKqQMa8AEB-AH-CYAC0AWKAgwIABABGD4gGCh_MA8=&rs=AOn4CLA5-ldUdokn_JPvx1Em0uajEMGL5A',
      width: 320,
      height: 180,
    },
    {
      url: 'https://i.ytimg.com/vi/acNujJNLO7U/hqdefault.jpg?sqp=-oaymwEmCOADEOgC8quKqQMa8AEB-AH-CYAC0AWKAgwIABABGD4gGCh_MA8=&rs=AOn4CLAr19tNyRaIBaMwAXwEjKoRU03_Og',
      width: 480,
      height: 360,
    },
    {
      url: 'https://i.ytimg.com/vi/acNujJNLO7U/sddefault.jpg?sqp=-oaymwEmCIAFEOAD8quKqQMa8AEB-AH-CYAC0AWKAgwIABABGD4gGCh_MA8=&rs=AOn4CLBBa7pAt93QKazzJ0KfJveH2uohyQ',
      width: 640,
      height: 480,
    },
  ],
  allowRatings: true,
  viewCount: null,
  isPrivate: false,
  isUnpluggedCorpus: false,
  isLiveContent: false,
  storyboards: [
    {
      width: '48',
      height: '27',
      thumbsCount: '100',
      columns: '10',
      rows: '10',
      interval: '0',
      storyboardCount: 1,
      url: [Array],
    },
    {
      width: '80',
      height: '45',
      thumbsCount: '73',
      columns: '10',
      rows: '10',
      interval: '2000',
      storyboardCount: 1,
      url: [Array],
    },
    {
      width: '160',
      height: '90',
      thumbsCount: '73',
      columns: '5',
      rows: '5',
      interval: '2000',
      storyboardCount: 3,
      url: [Array],
    },
  ],
  expiresInSeconds: '21540',
  formats: [
    {
      itag: 17,
      url: 'https://rr2---sn-4g5edndz.googlevideo.com/videoplayback?expire=1685401424&ei=8Np0ZPDjNJj91wKJ-5HwCw&ip=2a01%3A4f8%3Ac012%3A39be%3A%3A1&id=o-AOCHH2FcKwgfxr5jVJx9eBL0nII8vu65CGSEjP6WslK8&itag=17&source=youtube&requiressl=yes&mh=FO&mm=31%2C29&mn=sn-4g5edndz%2Csn-4g5lznes&ms=au%2Crdu&mv=m&mvi=2&pl=52&initcwndbps=558750&spc=qEK7Bztc-j52kjIWG6wiySeqe0hg4Ng&vprv=1&svpuc=1&mime=video%2F3gpp&gir=yes&clen=879077&dur=142.524&lmt=1610912462423821&mt=1685379408&fvip=1&fexp=24007246&beids=24350017&c=ANDROID&txp=5432434&sparams=expire%2Cei%2Cip%2Cid%2Citag%2Csource%2Crequiressl%2Cspc%2Cvprv%2Csvpuc%2Cmime%2Cgir%2Cclen%2Cdur%2Clmt&sig=AOq0QJ8wRAIgcsCOoDY04SXGoOLsev2dG6rV6WPovB8H-Bb-YCNExkkCIG-ciUzoFAQOv8YPRRnxwwMZKdfLyouyVq6b5FmSeJVR&lsparams=mh%2Cmm%2Cmn%2Cms%2Cmv%2Cmvi%2Cpl%2Cinitcwndbps&lsig=AG3C_xAwRAIgHF9Og-zez6jWsU1Or7NlDwTFDFrzJTeVtkPxxVg-jSYCIB4Kz_wJsnUqOpXEpzRy_AAzKAEgHMPzC-veL6zWq25p',
      mimeType: 'video/3gpp; codecs="mp4v.20.3, mp4a.40.2"',
      bitrate: 49386,
      width: 176,
      height: 144,
      lastModified: '1610912462423821',
      contentLength: '879077',
      quality: 'small',
      fps: 6,
      qualityLabel: '144p',
      projectionType: 'RECTANGULAR',
      averageBitrate: 49343,
      audioQuality: 'AUDIO_QUALITY_LOW',
      approxDurationMs: '142524',
      audioSampleRate: '22050',
      audioChannels: 1,
    },
    {
      itag: 18,
      url: 'https://rr2---sn-4g5edndz.googlevideo.com/videoplayback?expire=1685401424&ei=8Np0ZPDjNJj91wKJ-5HwCw&ip=2a01%3A4f8%3Ac012%3A39be%3A%3A1&id=o-AOCHH2FcKwgfxr5jVJx9eBL0nII8vu65CGSEjP6WslK8&itag=18&source=youtube&requiressl=yes&mh=FO&mm=31%2C29&mn=sn-4g5edndz%2Csn-4g5lznes&ms=au%2Crdu&mv=m&mvi=2&pl=52&initcwndbps=558750&spc=qEK7Bztc-j52kjIWG6wiySeqe0hg4Ng&vprv=1&svpuc=1&mime=video%2Fmp4&cnr=14&ratebypass=yes&dur=142.500&lmt=1666494785748098&mt=1685379408&fvip=1&fexp=24007246&beids=24350017&c=ANDROID&txp=5438434&sparams=expire%2Cei%2Cip%2Cid%2Citag%2Csource%2Crequiressl%2Cspc%2Cvprv%2Csvpuc%2Cmime%2Ccnr%2Cratebypass%2Cdur%2Clmt&sig=AOq0QJ8wRAIgQkrLKt0fBB5pEdCv7VjdtdabdNuiPJRnOz42cYV9dKsCIGEmFnkBjZsHG-BuZB16BgWoooM7bAAS9OmfMScnEd-z&lsparams=mh%2Cmm%2Cmn%2Cms%2Cmv%2Cmvi%2Cpl%2Cinitcwndbps&lsig=AG3C_xAwRAIgHF9Og-zez6jWsU1Or7NlDwTFDFrzJTeVtkPxxVg-jSYCIB4Kz_wJsnUqOpXEpzRy_AAzKAEgHMPzC-veL6zWq25p',
      mimeType: 'video/mp4; codecs="avc1.42001E, mp4a.40.2"',
      bitrate: 184348,
      width: 640,
      height: 360,
      lastModified: '1666494785748098',
      quality: 'medium',
      fps: 25,
      qualityLabel: '360p',
      projectionType: 'RECTANGULAR',
      audioQuality: 'AUDIO_QUALITY_LOW',
      approxDurationMs: '142500',
      audioSampleRate: '44100',
      audioChannels: 2,
    },
    {
      itag: 22,
      url: 'https://rr2---sn-4g5edndz.googlevideo.com/videoplayback?expire=1685401424&ei=8Np0ZPDjNJj91wKJ-5HwCw&ip=2a01%3A4f8%3Ac012%3A39be%3A%3A1&id=o-AOCHH2FcKwgfxr5jVJx9eBL0nII8vu65CGSEjP6WslK8&itag=22&source=youtube&requiressl=yes&mh=FO&mm=31%2C29&mn=sn-4g5edndz%2Csn-4g5lznes&ms=au%2Crdu&mv=m&mvi=2&pl=52&initcwndbps=558750&spc=qEK7Bztc-j52kjIWG6wiySeqe0hg4Ng&vprv=1&svpuc=1&mime=video%2Fmp4&cnr=14&ratebypass=yes&dur=142.500&lmt=1673718966702752&mt=1685379408&fvip=1&fexp=24007246&beids=24350017&c=ANDROID&txp=5432434&sparams=expire%2Cei%2Cip%2Cid%2Citag%2Csource%2Crequiressl%2Cspc%2Cvprv%2Csvpuc%2Cmime%2Ccnr%2Cratebypass%2Cdur%2Clmt&sig=AOq0QJ8wRgIhAKc_lS0RcUvl6n5pAvGB-eFOOR8mIwBBDYTuMuHEGx1NAiEAsXCG2qICEsEZRD2K10pT0CYMp4x8CuUd7_DBSystTe4%3D&lsparams=mh%2Cmm%2Cmn%2Cms%2Cmv%2Cmvi%2Cpl%2Cinitcwndbps&lsig=AG3C_xAwRAIgHF9Og-zez6jWsU1Or7NlDwTFDFrzJTeVtkPxxVg-jSYCIB4Kz_wJsnUqOpXEpzRy_AAzKAEgHMPzC-veL6zWq25p',
      mimeType: 'video/mp4; codecs="avc1.64001F, mp4a.40.2"',
      bitrate: 253832,
      width: 1280,
      height: 720,
      lastModified: '1673718966702752',
      quality: 'hd720',
      fps: 25,
      qualityLabel: '720p',
      projectionType: 'RECTANGULAR',
      audioQuality: 'AUDIO_QUALITY_MEDIUM',
      approxDurationMs: '142500',
      audioSampleRate: '44100',
      audioChannels: 2,
    },
  ],
  adaptiveFormats: [
    {
      itag: 137,
      url: 'https://rr2---sn-4g5edndz.googlevideo.com/videoplayback?expire=1685401424&ei=8Np0ZPDjNJj91wKJ-5HwCw&ip=2a01%3A4f8%3Ac012%3A39be%3A%3A1&id=o-AOCHH2FcKwgfxr5jVJx9eBL0nII8vu65CGSEjP6WslK8&itag=137&source=youtube&requiressl=yes&mh=FO&mm=31%2C29&mn=sn-4g5edndz%2Csn-4g5lznes&ms=au%2Crdu&mv=m&mvi=2&pl=52&initcwndbps=558750&spc=qEK7Bztc-j52kjIWG6wiySeqe0hg4Ng&vprv=1&svpuc=1&mime=video%2Fmp4&gir=yes&clen=11259267&dur=142.440&lmt=1610912518440740&mt=1685379408&fvip=1&keepalive=yes&fexp=24007246&beids=24350017&c=ANDROID&txp=5432434&sparams=expire%2Cei%2Cip%2Cid%2Citag%2Csource%2Crequiressl%2Cspc%2Cvprv%2Csvpuc%2Cmime%2Cgir%2Cclen%2Cdur%2Clmt&sig=AOq0QJ8wRQIhALe0G7zOuiaWyJE42QXRzHtaMgBZlQyzaq0ZffykLl5sAiBjO03E8-UPIWm_23MVvLt3ymqeHK5t0UpKcleUkbc-EQ%3D%3D&lsparams=mh%2Cmm%2Cmn%2Cms%2Cmv%2Cmvi%2Cpl%2Cinitcwndbps&lsig=AG3C_xAwRAIgHF9Og-zez6jWsU1Or7NlDwTFDFrzJTeVtkPxxVg-jSYCIB4Kz_wJsnUqOpXEpzRy_AAzKAEgHMPzC-veL6zWq25p',
      mimeType: 'video/mp4; codecs="avc1.640028"',
      bitrate: 660427,
      width: 1920,
      height: 1080,
      initRange: [Object],
      indexRange: [Object],
      lastModified: '1610912518440740',
      contentLength: '11259267',
      quality: 'hd1080',
      fps: 25,
      qualityLabel: '1080p',
      projectionType: 'RECTANGULAR',
      averageBitrate: 632365,
      approxDurationMs: '142440',
    },
    {
      itag: 248,
      url: 'https://rr2---sn-4g5edndz.googlevideo.com/videoplayback?expire=1685401424&ei=8Np0ZPDjNJj91wKJ-5HwCw&ip=2a01%3A4f8%3Ac012%3A39be%3A%3A1&id=o-AOCHH2FcKwgfxr5jVJx9eBL0nII8vu65CGSEjP6WslK8&itag=248&source=youtube&requiressl=yes&mh=FO&mm=31%2C29&mn=sn-4g5edndz%2Csn-4g5lznes&ms=au%2Crdu&mv=m&mvi=2&pl=52&initcwndbps=558750&spc=qEK7Bztc-j52kjIWG6wiySeqe0hg4Ng&vprv=1&svpuc=1&mime=video%2Fwebm&gir=yes&clen=12115160&dur=142.440&lmt=1610913890236339&mt=1685379408&fvip=1&keepalive=yes&fexp=24007246&beids=24350017&c=ANDROID&txp=5432434&sparams=expire%2Cei%2Cip%2Cid%2Citag%2Csource%2Crequiressl%2Cspc%2Cvprv%2Csvpuc%2Cmime%2Cgir%2Cclen%2Cdur%2Clmt&sig=AOq0QJ8wRAIgXd2eG9LBHBs09MWLsMKTO669yrjSoarlerkgpb5fk1UCIDVLOKXu_-dxZEl6eFv08p4kW8a9zu5QUJcPhpAH100R&lsparams=mh%2Cmm%2Cmn%2Cms%2Cmv%2Cmvi%2Cpl%2Cinitcwndbps&lsig=AG3C_xAwRAIgHF9Og-zez6jWsU1Or7NlDwTFDFrzJTeVtkPxxVg-jSYCIB4Kz_wJsnUqOpXEpzRy_AAzKAEgHMPzC-veL6zWq25p',
      mimeType: 'video/webm; codecs="vp9"',
      bitrate: 702432,
      width: 1920,
      height: 1080,
      initRange: [Object],
      indexRange: [Object],
      lastModified: '1610913890236339',
      contentLength: '12115160',
      quality: 'hd1080',
      fps: 25,
      qualityLabel: '1080p',
      projectionType: 'RECTANGULAR',
      averageBitrate: 680435,
      colorInfo: [Object],
      approxDurationMs: '142440',
    },
    {
      itag: 399,
      url: 'https://rr2---sn-4g5edndz.googlevideo.com/videoplayback?expire=1685401424&ei=8Np0ZPDjNJj91wKJ-5HwCw&ip=2a01%3A4f8%3Ac012%3A39be%3A%3A1&id=o-AOCHH2FcKwgfxr5jVJx9eBL0nII8vu65CGSEjP6WslK8&itag=399&source=youtube&requiressl=yes&mh=FO&mm=31%2C29&mn=sn-4g5edndz%2Csn-4g5lznes&ms=au%2Crdu&mv=m&mvi=2&pl=52&initcwndbps=558750&spc=qEK7Bztc-j52kjIWG6wiySeqe0hg4Ng&vprv=1&svpuc=1&mime=video%2Fmp4&gir=yes&clen=12537120&dur=142.440&lmt=1623739511905055&mt=1685379408&fvip=1&keepalive=yes&fexp=24007246&beids=24350017&c=ANDROID&txp=5436432&sparams=expire%2Cei%2Cip%2Cid%2Citag%2Csource%2Crequiressl%2Cspc%2Cvprv%2Csvpuc%2Cmime%2Cgir%2Cclen%2Cdur%2Clmt&sig=AOq0QJ8wRQIgV1CsCNSZSYJPE5whUQrDIr685kG2iZj1lltMW_gohikCIQCVqYVrFDytgjUmwdTI4FCr4sbYqOneLwcG9y1YR_IG_Q%3D%3D&lsparams=mh%2Cmm%2Cmn%2Cms%2Cmv%2Cmvi%2Cpl%2Cinitcwndbps&lsig=AG3C_xAwRAIgHF9Og-zez6jWsU1Or7NlDwTFDFrzJTeVtkPxxVg-jSYCIB4Kz_wJsnUqOpXEpzRy_AAzKAEgHMPzC-veL6zWq25p',
      mimeType: 'video/mp4; codecs="av01.0.08M.08"',
      bitrate: 742214,
      width: 1920,
      height: 1080,
      initRange: [Object],
      indexRange: [Object],
      lastModified: '1623739511905055',
      contentLength: '12537120',
      quality: 'hd1080',
      fps: 25,
      qualityLabel: '1080p',
      projectionType: 'RECTANGULAR',
      averageBitrate: 704134,
      colorInfo: [Object],
      approxDurationMs: '142440',
    },
    {
      itag: 136,
      url: 'https://rr2---sn-4g5edndz.googlevideo.com/videoplayback?expire=1685401424&ei=8Np0ZPDjNJj91wKJ-5HwCw&ip=2a01%3A4f8%3Ac012%3A39be%3A%3A1&id=o-AOCHH2FcKwgfxr5jVJx9eBL0nII8vu65CGSEjP6WslK8&itag=136&source=youtube&requiressl=yes&mh=FO&mm=31%2C29&mn=sn-4g5edndz%2Csn-4g5lznes&ms=au%2Crdu&mv=m&mvi=2&pl=52&initcwndbps=558750&spc=qEK7Bztc-j52kjIWG6wiySeqe0hg4Ng&vprv=1&svpuc=1&mime=video%2Fmp4&gir=yes&clen=2216867&dur=142.440&lmt=1610912315849513&mt=1685379408&fvip=1&keepalive=yes&fexp=24007246&beids=24350017&c=ANDROID&txp=5432434&sparams=expire%2Cei%2Cip%2Cid%2Citag%2Csource%2Crequiressl%2Cspc%2Cvprv%2Csvpuc%2Cmime%2Cgir%2Cclen%2Cdur%2Clmt&sig=AOq0QJ8wRQIhAJQIaGdvav4FrBVdooHk9B8le6Zs1B8FE9pkIp-Ot_djAiAsG2WIbgQgjn1KHgTPsNXw5H2UE-kqHM8DFPdRCehPBg%3D%3D&lsparams=mh%2Cmm%2Cmn%2Cms%2Cmv%2Cmvi%2Cpl%2Cinitcwndbps&lsig=AG3C_xAwRAIgHF9Og-zez6jWsU1Or7NlDwTFDFrzJTeVtkPxxVg-jSYCIB4Kz_wJsnUqOpXEpzRy_AAzKAEgHMPzC-veL6zWq25p',
      mimeType: 'video/mp4; codecs="avc1.4d401f"',
      bitrate: 129080,
      width: 1280,
      height: 720,
      initRange: [Object],
      indexRange: [Object],
      lastModified: '1610912315849513',
      contentLength: '2216867',
      quality: 'hd720',
      fps: 25,
      qualityLabel: '720p',
      projectionType: 'RECTANGULAR',
      averageBitrate: 124508,
      approxDurationMs: '142440',
    },
    {
      itag: 247,
      url: 'https://rr2---sn-4g5edndz.googlevideo.com/videoplayback?expire=1685401424&ei=8Np0ZPDjNJj91wKJ-5HwCw&ip=2a01%3A4f8%3Ac012%3A39be%3A%3A1&id=o-AOCHH2FcKwgfxr5jVJx9eBL0nII8vu65CGSEjP6WslK8&itag=247&source=youtube&requiressl=yes&mh=FO&mm=31%2C29&mn=sn-4g5edndz%2Csn-4g5lznes&ms=au%2Crdu&mv=m&mvi=2&pl=52&initcwndbps=558750&spc=qEK7Bztc-j52kjIWG6wiySeqe0hg4Ng&vprv=1&svpuc=1&mime=video%2Fwebm&gir=yes&clen=6484577&dur=142.440&lmt=1610912493006296&mt=1685379408&fvip=1&keepalive=yes&fexp=24007246&beids=24350017&c=ANDROID&txp=5432434&sparams=expire%2Cei%2Cip%2Cid%2Citag%2Csource%2Crequiressl%2Cspc%2Cvprv%2Csvpuc%2Cmime%2Cgir%2Cclen%2Cdur%2Clmt&sig=AOq0QJ8wRgIhAOol580RuEq_1YOSKZ4wZhv0C1wu7hXmaB79IXma_7lQAiEAhNcierKOqZv5dbXS4plHLIIiw6niz9B17LX4bStaiZo%3D&lsparams=mh%2Cmm%2Cmn%2Cms%2Cmv%2Cmvi%2Cpl%2Cinitcwndbps&lsig=AG3C_xAwRAIgHF9Og-zez6jWsU1Or7NlDwTFDFrzJTeVtkPxxVg-jSYCIB4Kz_wJsnUqOpXEpzRy_AAzKAEgHMPzC-veL6zWq25p',
      mimeType: 'video/webm; codecs="vp9"',
      bitrate: 371209,
      width: 1280,
      height: 720,
      initRange: [Object],
      indexRange: [Object],
      lastModified: '1610912493006296',
      contentLength: '6484577',
      quality: 'hd720',
      fps: 25,
      qualityLabel: '720p',
      projectionType: 'RECTANGULAR',
      averageBitrate: 364199,
      colorInfo: [Object],
      approxDurationMs: '142440',
    },
    {
      itag: 398,
      url: 'https://rr2---sn-4g5edndz.googlevideo.com/videoplayback?expire=1685401424&ei=8Np0ZPDjNJj91wKJ-5HwCw&ip=2a01%3A4f8%3Ac012%3A39be%3A%3A1&id=o-AOCHH2FcKwgfxr5jVJx9eBL0nII8vu65CGSEjP6WslK8&itag=398&source=youtube&requiressl=yes&mh=FO&mm=31%2C29&mn=sn-4g5edndz%2Csn-4g5lznes&ms=au%2Crdu&mv=m&mvi=2&pl=52&initcwndbps=558750&spc=qEK7Bztc-j52kjIWG6wiySeqe0hg4Ng&vprv=1&svpuc=1&mime=video%2Fmp4&gir=yes&clen=11795949&dur=142.440&lmt=1623739508884624&mt=1685379408&fvip=1&keepalive=yes&fexp=24007246&beids=24350017&c=ANDROID&txp=5436432&sparams=expire%2Cei%2Cip%2Cid%2Citag%2Csource%2Crequiressl%2Cspc%2Cvprv%2Csvpuc%2Cmime%2Cgir%2Cclen%2Cdur%2Clmt&sig=AOq0QJ8wRQIgaQ2rZImy6C89va4ltOFKUWibtMaP6GlnltS7rh6EfzECIQCOol0JZG0JvQXK4gKBujwYBybQKr4V4IMgZUeNBTnjmw%3D%3D&lsparams=mh%2Cmm%2Cmn%2Cms%2Cmv%2Cmvi%2Cpl%2Cinitcwndbps&lsig=AG3C_xAwRAIgHF9Og-zez6jWsU1Or7NlDwTFDFrzJTeVtkPxxVg-jSYCIB4Kz_wJsnUqOpXEpzRy_AAzKAEgHMPzC-veL6zWq25p',
      mimeType: 'video/mp4; codecs="av01.0.05M.08"',
      bitrate: 693148,
      width: 1280,
      height: 720,
      initRange: [Object],
      indexRange: [Object],
      lastModified: '1623739508884624',
      contentLength: '11795949',
      quality: 'hd720',
      fps: 25,
      qualityLabel: '720p',
      projectionType: 'RECTANGULAR',
      averageBitrate: 662507,
      colorInfo: [Object],
      approxDurationMs: '142440',
    },
    {
      itag: 135,
      url: 'https://rr2---sn-4g5edndz.googlevideo.com/videoplayback?expire=1685401424&ei=8Np0ZPDjNJj91wKJ-5HwCw&ip=2a01%3A4f8%3Ac012%3A39be%3A%3A1&id=o-AOCHH2FcKwgfxr5jVJx9eBL0nII8vu65CGSEjP6WslK8&itag=135&source=youtube&requiressl=yes&mh=FO&mm=31%2C29&mn=sn-4g5edndz%2Csn-4g5lznes&ms=au%2Crdu&mv=m&mvi=2&pl=52&initcwndbps=558750&spc=qEK7Bztc-j52kjIWG6wiySeqe0hg4Ng&vprv=1&svpuc=1&mime=video%2Fmp4&gir=yes&clen=1499389&dur=142.440&lmt=1610912301151177&mt=1685379408&fvip=1&keepalive=yes&fexp=24007246&beids=24350017&c=ANDROID&txp=5432434&sparams=expire%2Cei%2Cip%2Cid%2Citag%2Csource%2Crequiressl%2Cspc%2Cvprv%2Csvpuc%2Cmime%2Cgir%2Cclen%2Cdur%2Clmt&sig=AOq0QJ8wRQIhAOk4ZiwOcVT8__AA49NC_2tALfxFmMo-auX5-UOVqcTuAiBH890lzcyR1kZ0RJFJkUNfsquleMNakZ8itYaip-JrLg%3D%3D&lsparams=mh%2Cmm%2Cmn%2Cms%2Cmv%2Cmvi%2Cpl%2Cinitcwndbps&lsig=AG3C_xAwRAIgHF9Og-zez6jWsU1Or7NlDwTFDFrzJTeVtkPxxVg-jSYCIB4Kz_wJsnUqOpXEpzRy_AAzKAEgHMPzC-veL6zWq25p',
      mimeType: 'video/mp4; codecs="avc1.4d401e"',
      bitrate: 87137,
      width: 854,
      height: 480,
      initRange: [Object],
      indexRange: [Object],
      lastModified: '1610912301151177',
      contentLength: '1499389',
      quality: 'large',
      fps: 25,
      qualityLabel: '480p',
      projectionType: 'RECTANGULAR',
      averageBitrate: 84211,
      approxDurationMs: '142440',
    },
    {
      itag: 244,
      url: 'https://rr2---sn-4g5edndz.googlevideo.com/videoplayback?expire=1685401424&ei=8Np0ZPDjNJj91wKJ-5HwCw&ip=2a01%3A4f8%3Ac012%3A39be%3A%3A1&id=o-AOCHH2FcKwgfxr5jVJx9eBL0nII8vu65CGSEjP6WslK8&itag=244&source=youtube&requiressl=yes&mh=FO&mm=31%2C29&mn=sn-4g5edndz%2Csn-4g5lznes&ms=au%2Crdu&mv=m&mvi=2&pl=52&initcwndbps=558750&spc=qEK7Bztc-j52kjIWG6wiySeqe0hg4Ng&vprv=1&svpuc=1&mime=video%2Fwebm&gir=yes&clen=3257269&dur=142.440&lmt=1610912460146684&mt=1685379408&fvip=1&keepalive=yes&fexp=24007246&beids=24350017&c=ANDROID&txp=5432434&sparams=expire%2Cei%2Cip%2Cid%2Citag%2Csource%2Crequiressl%2Cspc%2Cvprv%2Csvpuc%2Cmime%2Cgir%2Cclen%2Cdur%2Clmt&sig=AOq0QJ8wRQIhAJ88xXImiARLo8vv0-pQDYNkkWue_OIZ9y3-C1G-x2mOAiB6jMaPFsMc04RzE65RSNod-WlGb66jTeEV5hyxez05jw%3D%3D&lsparams=mh%2Cmm%2Cmn%2Cms%2Cmv%2Cmvi%2Cpl%2Cinitcwndbps&lsig=AG3C_xAwRAIgHF9Og-zez6jWsU1Or7NlDwTFDFrzJTeVtkPxxVg-jSYCIB4Kz_wJsnUqOpXEpzRy_AAzKAEgHMPzC-veL6zWq25p',
      mimeType: 'video/webm; codecs="vp9"',
      bitrate: 242481,
      width: 854,
      height: 480,
      initRange: [Object],
      indexRange: [Object],
      lastModified: '1610912460146684',
      contentLength: '3257269',
      quality: 'large',
      fps: 25,
      qualityLabel: '480p',
      projectionType: 'RECTANGULAR',
      averageBitrate: 182941,
      colorInfo: [Object],
      approxDurationMs: '142440',
    },
    {
      itag: 397,
      url: 'https://rr2---sn-4g5edndz.googlevideo.com/videoplayback?expire=1685401424&ei=8Np0ZPDjNJj91wKJ-5HwCw&ip=2a01%3A4f8%3Ac012%3A39be%3A%3A1&id=o-AOCHH2FcKwgfxr5jVJx9eBL0nII8vu65CGSEjP6WslK8&itag=397&source=youtube&requiressl=yes&mh=FO&mm=31%2C29&mn=sn-4g5edndz%2Csn-4g5lznes&ms=au%2Crdu&mv=m&mvi=2&pl=52&initcwndbps=558750&spc=qEK7Bztc-j52kjIWG6wiySeqe0hg4Ng&vprv=1&svpuc=1&mime=video%2Fmp4&gir=yes&clen=3955331&dur=142.440&lmt=1623739507980187&mt=1685379408&fvip=1&keepalive=yes&fexp=24007246&beids=24350017&c=ANDROID&txp=5436432&sparams=expire%2Cei%2Cip%2Cid%2Citag%2Csource%2Crequiressl%2Cspc%2Cvprv%2Csvpuc%2Cmime%2Cgir%2Cclen%2Cdur%2Clmt&sig=AOq0QJ8wRQIgCPWaeT5KVEv0vt7kSNQNKu1Kifre4xy-WyeIyHBy7eYCIQDoWdSNVzwyFURPlVyrgV8eRwElUrPgO0dicqHo_pvjdQ%3D%3D&lsparams=mh%2Cmm%2Cmn%2Cms%2Cmv%2Cmvi%2Cpl%2Cinitcwndbps&lsig=AG3C_xAwRAIgHF9Og-zez6jWsU1Or7NlDwTFDFrzJTeVtkPxxVg-jSYCIB4Kz_wJsnUqOpXEpzRy_AAzKAEgHMPzC-veL6zWq25p',
      mimeType: 'video/mp4; codecs="av01.0.04M.08"',
      bitrate: 234628,
      width: 854,
      height: 480,
      initRange: [Object],
      indexRange: [Object],
      lastModified: '1623739507980187',
      contentLength: '3955331',
      quality: 'large',
      fps: 25,
      qualityLabel: '480p',
      projectionType: 'RECTANGULAR',
      averageBitrate: 222147,
      colorInfo: [Object],
      approxDurationMs: '142440',
    },
    {
      itag: 134,
      url: 'https://rr2---sn-4g5edndz.googlevideo.com/videoplayback?expire=1685401424&ei=8Np0ZPDjNJj91wKJ-5HwCw&ip=2a01%3A4f8%3Ac012%3A39be%3A%3A1&id=o-AOCHH2FcKwgfxr5jVJx9eBL0nII8vu65CGSEjP6WslK8&itag=134&source=youtube&requiressl=yes&mh=FO&mm=31%2C29&mn=sn-4g5edndz%2Csn-4g5lznes&ms=au%2Crdu&mv=m&mvi=2&pl=52&initcwndbps=558750&spc=qEK7Bztc-j52kjIWG6wiySeqe0hg4Ng&vprv=1&svpuc=1&mime=video%2Fmp4&gir=yes&clen=979865&dur=142.440&lmt=1610912287953980&mt=1685379408&fvip=1&keepalive=yes&fexp=24007246&beids=24350017&c=ANDROID&txp=5432434&sparams=expire%2Cei%2Cip%2Cid%2Citag%2Csource%2Crequiressl%2Cspc%2Cvprv%2Csvpuc%2Cmime%2Cgir%2Cclen%2Cdur%2Clmt&sig=AOq0QJ8wRQIhAMl1tPKKz1uZUt6GWWLZb-ajV1rFHHel5BKI0r4xfpuLAiA8eVH-RSNB8FWabkvQQ73js9BCORC80dG5WCjwB810HA%3D%3D&lsparams=mh%2Cmm%2Cmn%2Cms%2Cmv%2Cmvi%2Cpl%2Cinitcwndbps&lsig=AG3C_xAwRAIgHF9Og-zez6jWsU1Or7NlDwTFDFrzJTeVtkPxxVg-jSYCIB4Kz_wJsnUqOpXEpzRy_AAzKAEgHMPzC-veL6zWq25p',
      mimeType: 'video/mp4; codecs="avc1.4d401e"',
      bitrate: 58331,
      width: 640,
      height: 360,
      initRange: [Object],
      indexRange: [Object],
      lastModified: '1610912287953980',
      contentLength: '979865',
      quality: 'medium',
      fps: 25,
      qualityLabel: '360p',
      projectionType: 'RECTANGULAR',
      averageBitrate: 55033,
      highReplication: true,
      approxDurationMs: '142440',
    },
    {
      itag: 243,
      url: 'https://rr2---sn-4g5edndz.googlevideo.com/videoplayback?expire=1685401424&ei=8Np0ZPDjNJj91wKJ-5HwCw&ip=2a01%3A4f8%3Ac012%3A39be%3A%3A1&id=o-AOCHH2FcKwgfxr5jVJx9eBL0nII8vu65CGSEjP6WslK8&itag=243&source=youtube&requiressl=yes&mh=FO&mm=31%2C29&mn=sn-4g5edndz%2Csn-4g5lznes&ms=au%2Crdu&mv=m&mvi=2&pl=52&initcwndbps=558750&spc=qEK7Bztc-j52kjIWG6wiySeqe0hg4Ng&vprv=1&svpuc=1&mime=video%2Fwebm&gir=yes&clen=1834493&dur=142.440&lmt=1610912478434505&mt=1685379408&fvip=1&keepalive=yes&fexp=24007246&beids=24350017&c=ANDROID&txp=5432434&sparams=expire%2Cei%2Cip%2Cid%2Citag%2Csource%2Crequiressl%2Cspc%2Cvprv%2Csvpuc%2Cmime%2Cgir%2Cclen%2Cdur%2Clmt&sig=AOq0QJ8wRQIhAIk9LeRucFi_LSpSO57bX7rjlNsQyzYs0PDiMty4ecxVAiA7lT8xzqVKN9tIwah7ynKylmQGToUDqU_uY-Rrm69nYA%3D%3D&lsparams=mh%2Cmm%2Cmn%2Cms%2Cmv%2Cmvi%2Cpl%2Cinitcwndbps&lsig=AG3C_xAwRAIgHF9Og-zez6jWsU1Or7NlDwTFDFrzJTeVtkPxxVg-jSYCIB4Kz_wJsnUqOpXEpzRy_AAzKAEgHMPzC-veL6zWq25p',
      mimeType: 'video/webm; codecs="vp9"',
      bitrate: 142000,
      width: 640,
      height: 360,
      initRange: [Object],
      indexRange: [Object],
      lastModified: '1610912478434505',
      contentLength: '1834493',
      quality: 'medium',
      fps: 25,
      qualityLabel: '360p',
      projectionType: 'RECTANGULAR',
      averageBitrate: 103032,
      colorInfo: [Object],
      approxDurationMs: '142440',
    },
    {
      itag: 396,
      url: 'https://rr2---sn-4g5edndz.googlevideo.com/videoplayback?expire=1685401424&ei=8Np0ZPDjNJj91wKJ-5HwCw&ip=2a01%3A4f8%3Ac012%3A39be%3A%3A1&id=o-AOCHH2FcKwgfxr5jVJx9eBL0nII8vu65CGSEjP6WslK8&itag=396&source=youtube&requiressl=yes&mh=FO&mm=31%2C29&mn=sn-4g5edndz%2Csn-4g5lznes&ms=au%2Crdu&mv=m&mvi=2&pl=52&initcwndbps=558750&spc=qEK7Bztc-j52kjIWG6wiySeqe0hg4Ng&vprv=1&svpuc=1&mime=video%2Fmp4&gir=yes&clen=2568215&dur=142.440&lmt=1623739509183715&mt=1685379408&fvip=1&keepalive=yes&fexp=24007246&beids=24350017&c=ANDROID&txp=5436432&sparams=expire%2Cei%2Cip%2Cid%2Citag%2Csource%2Crequiressl%2Cspc%2Cvprv%2Csvpuc%2Cmime%2Cgir%2Cclen%2Cdur%2Clmt&sig=AOq0QJ8wRQIhAK72gxYWk3FBLi2rJWcTvjidIaRse7Y6i0A1tr905pYXAiAa36lyatP6ZC-4vG4RFaA0j_EFZvG-qqBFWKPR_dF_qg%3D%3D&lsparams=mh%2Cmm%2Cmn%2Cms%2Cmv%2Cmvi%2Cpl%2Cinitcwndbps&lsig=AG3C_xAwRAIgHF9Og-zez6jWsU1Or7NlDwTFDFrzJTeVtkPxxVg-jSYCIB4Kz_wJsnUqOpXEpzRy_AAzKAEgHMPzC-veL6zWq25p',
      mimeType: 'video/mp4; codecs="av01.0.01M.08"',
      bitrate: 153398,
      width: 640,
      height: 360,
      initRange: [Object],
      indexRange: [Object],
      lastModified: '1623739509183715',
      contentLength: '2568215',
      quality: 'medium',
      fps: 25,
      qualityLabel: '360p',
      projectionType: 'RECTANGULAR',
      averageBitrate: 144241,
      colorInfo: [Object],
      approxDurationMs: '142440',
    },
    {
      itag: 133,
      url: 'https://rr2---sn-4g5edndz.googlevideo.com/videoplayback?expire=1685401424&ei=8Np0ZPDjNJj91wKJ-5HwCw&ip=2a01%3A4f8%3Ac012%3A39be%3A%3A1&id=o-AOCHH2FcKwgfxr5jVJx9eBL0nII8vu65CGSEjP6WslK8&itag=133&source=youtube&requiressl=yes&mh=FO&mm=31%2C29&mn=sn-4g5edndz%2Csn-4g5lznes&ms=au%2Crdu&mv=m&mvi=2&pl=52&initcwndbps=558750&spc=qEK7Bztc-j52kjIWG6wiySeqe0hg4Ng&vprv=1&svpuc=1&mime=video%2Fmp4&gir=yes&clen=577374&dur=142.440&lmt=1610912463433880&mt=1685379408&fvip=1&keepalive=yes&fexp=24007246&beids=24350017&c=ANDROID&txp=5432434&sparams=expire%2Cei%2Cip%2Cid%2Citag%2Csource%2Crequiressl%2Cspc%2Cvprv%2Csvpuc%2Cmime%2Cgir%2Cclen%2Cdur%2Clmt&sig=AOq0QJ8wRQIgUuaApRdcS_o4Mbn9e9srbudE0Z2oU5N7LtzyxXoiMHYCIQCefPjNg4fQWf7mjPNI8wLbHiM2LYS509bYvs17LlvcJA%3D%3D&lsparams=mh%2Cmm%2Cmn%2Cms%2Cmv%2Cmvi%2Cpl%2Cinitcwndbps&lsig=AG3C_xAwRAIgHF9Og-zez6jWsU1Or7NlDwTFDFrzJTeVtkPxxVg-jSYCIB4Kz_wJsnUqOpXEpzRy_AAzKAEgHMPzC-veL6zWq25p',
      mimeType: 'video/mp4; codecs="avc1.4d4015"',
      bitrate: 34996,
      width: 426,
      height: 240,
      initRange: [Object],
      indexRange: [Object],
      lastModified: '1610912463433880',
      contentLength: '577374',
      quality: 'small',
      fps: 25,
      qualityLabel: '240p',
      projectionType: 'RECTANGULAR',
      averageBitrate: 32427,
      approxDurationMs: '142440',
    },
    {
      itag: 242,
      url: 'https://rr2---sn-4g5edndz.googlevideo.com/videoplayback?expire=1685401424&ei=8Np0ZPDjNJj91wKJ-5HwCw&ip=2a01%3A4f8%3Ac012%3A39be%3A%3A1&id=o-AOCHH2FcKwgfxr5jVJx9eBL0nII8vu65CGSEjP6WslK8&itag=242&source=youtube&requiressl=yes&mh=FO&mm=31%2C29&mn=sn-4g5edndz%2Csn-4g5lznes&ms=au%2Crdu&mv=m&mvi=2&pl=52&initcwndbps=558750&spc=qEK7Bztc-j52kjIWG6wiySeqe0hg4Ng&vprv=1&svpuc=1&mime=video%2Fwebm&gir=yes&clen=840850&dur=142.440&lmt=1610912487053365&mt=1685379408&fvip=1&keepalive=yes&fexp=24007246&beids=24350017&c=ANDROID&txp=5432434&sparams=expire%2Cei%2Cip%2Cid%2Citag%2Csource%2Crequiressl%2Cspc%2Cvprv%2Csvpuc%2Cmime%2Cgir%2Cclen%2Cdur%2Clmt&sig=AOq0QJ8wRQIhANcdNip1sSAH4P1vAyztPhtu6xIsCJoe_iS4qgvcev1yAiBpteHiziAH4U4IiFlO7mibYOxhK7Jt_qqCzFuKVvkrUg%3D%3D&lsparams=mh%2Cmm%2Cmn%2Cms%2Cmv%2Cmvi%2Cpl%2Cinitcwndbps&lsig=AG3C_xAwRAIgHF9Og-zez6jWsU1Or7NlDwTFDFrzJTeVtkPxxVg-jSYCIB4Kz_wJsnUqOpXEpzRy_AAzKAEgHMPzC-veL6zWq25p',
      mimeType: 'video/webm; codecs="vp9"',
      bitrate: 69222,
      width: 426,
      height: 240,
      initRange: [Object],
      indexRange: [Object],
      lastModified: '1610912487053365',
      contentLength: '840850',
      quality: 'small',
      fps: 25,
      qualityLabel: '240p',
      projectionType: 'RECTANGULAR',
      averageBitrate: 47225,
      colorInfo: [Object],
      approxDurationMs: '142440',
    },
    {
      itag: 395,
      url: 'https://rr2---sn-4g5edndz.googlevideo.com/videoplayback?expire=1685401424&ei=8Np0ZPDjNJj91wKJ-5HwCw&ip=2a01%3A4f8%3Ac012%3A39be%3A%3A1&id=o-AOCHH2FcKwgfxr5jVJx9eBL0nII8vu65CGSEjP6WslK8&itag=395&source=youtube&requiressl=yes&mh=FO&mm=31%2C29&mn=sn-4g5edndz%2Csn-4g5lznes&ms=au%2Crdu&mv=m&mvi=2&pl=52&initcwndbps=558750&spc=qEK7Bztc-j52kjIWG6wiySeqe0hg4Ng&vprv=1&svpuc=1&mime=video%2Fmp4&gir=yes&clen=1775767&dur=142.440&lmt=1623739508992614&mt=1685379408&fvip=1&keepalive=yes&fexp=24007246&beids=24350017&c=ANDROID&txp=5436432&sparams=expire%2Cei%2Cip%2Cid%2Citag%2Csource%2Crequiressl%2Cspc%2Cvprv%2Csvpuc%2Cmime%2Cgir%2Cclen%2Cdur%2Clmt&sig=AOq0QJ8wRQIhAMzRDXvf9hBhrO4Pucr_H0FJD6HtYnt1LRJ7UkgHUn5oAiAJ4bk1IiMrlZTK_UTLSChzQqch4Z8-TW3McUcRFkOi5w%3D%3D&lsparams=mh%2Cmm%2Cmn%2Cms%2Cmv%2Cmvi%2Cpl%2Cinitcwndbps&lsig=AG3C_xAwRAIgHF9Og-zez6jWsU1Or7NlDwTFDFrzJTeVtkPxxVg-jSYCIB4Kz_wJsnUqOpXEpzRy_AAzKAEgHMPzC-veL6zWq25p',
      mimeType: 'video/mp4; codecs="av01.0.00M.08"',
      bitrate: 104623,
      width: 426,
      height: 240,
      initRange: [Object],
      indexRange: [Object],
      lastModified: '1623739508992614',
      contentLength: '1775767',
      quality: 'small',
      fps: 25,
      qualityLabel: '240p',
      projectionType: 'RECTANGULAR',
      averageBitrate: 99734,
      colorInfo: [Object],
      approxDurationMs: '142440',
    },
    {
      itag: 160,
      url: 'https://rr2---sn-4g5edndz.googlevideo.com/videoplayback?expire=1685401424&ei=8Np0ZPDjNJj91wKJ-5HwCw&ip=2a01%3A4f8%3Ac012%3A39be%3A%3A1&id=o-AOCHH2FcKwgfxr5jVJx9eBL0nII8vu65CGSEjP6WslK8&itag=160&source=youtube&requiressl=yes&mh=FO&mm=31%2C29&mn=sn-4g5edndz%2Csn-4g5lznes&ms=au%2Crdu&mv=m&mvi=2&pl=52&initcwndbps=558750&spc=qEK7Bztc-j52kjIWG6wiySeqe0hg4Ng&vprv=1&svpuc=1&mime=video%2Fmp4&gir=yes&clen=308122&dur=142.440&lmt=1610912430033816&mt=1685379408&fvip=1&keepalive=yes&fexp=24007246&beids=24350017&c=ANDROID&txp=5432434&sparams=expire%2Cei%2Cip%2Cid%2Citag%2Csource%2Crequiressl%2Cspc%2Cvprv%2Csvpuc%2Cmime%2Cgir%2Cclen%2Cdur%2Clmt&sig=AOq0QJ8wRAIgM4MmkMCAQWNhppMatx0N9gGLN6YJR2wJcE1ys6W8yOICIHcUPvwhSFKZQr0FFuhU81NcA1AxZ81La3vW3TAlg4eF&lsparams=mh%2Cmm%2Cmn%2Cms%2Cmv%2Cmvi%2Cpl%2Cinitcwndbps&lsig=AG3C_xAwRAIgHF9Og-zez6jWsU1Or7NlDwTFDFrzJTeVtkPxxVg-jSYCIB4Kz_wJsnUqOpXEpzRy_AAzKAEgHMPzC-veL6zWq25p',
      mimeType: 'video/mp4; codecs="avc1.4d400c"',
      bitrate: 19698,
      width: 256,
      height: 144,
      initRange: [Object],
      indexRange: [Object],
      lastModified: '1610912430033816',
      contentLength: '308122',
      quality: 'tiny',
      fps: 25,
      qualityLabel: '144p',
      projectionType: 'RECTANGULAR',
      averageBitrate: 17305,
      approxDurationMs: '142440',
    },
    {
      itag: 278,
      url: 'https://rr2---sn-4g5edndz.googlevideo.com/videoplayback?expire=1685401424&ei=8Np0ZPDjNJj91wKJ-5HwCw&ip=2a01%3A4f8%3Ac012%3A39be%3A%3A1&id=o-AOCHH2FcKwgfxr5jVJx9eBL0nII8vu65CGSEjP6WslK8&itag=278&source=youtube&requiressl=yes&mh=FO&mm=31%2C29&mn=sn-4g5edndz%2Csn-4g5lznes&ms=au%2Crdu&mv=m&mvi=2&pl=52&initcwndbps=558750&spc=qEK7Bztc-j52kjIWG6wiySeqe0hg4Ng&vprv=1&svpuc=1&mime=video%2Fwebm&gir=yes&clen=965268&dur=142.440&lmt=1610912532867685&mt=1685379408&fvip=1&keepalive=yes&fexp=24007246&beids=24350017&c=ANDROID&txp=5432434&sparams=expire%2Cei%2Cip%2Cid%2Citag%2Csource%2Crequiressl%2Cspc%2Cvprv%2Csvpuc%2Cmime%2Cgir%2Cclen%2Cdur%2Clmt&sig=AOq0QJ8wRQIhANMfquKAJnalq_Mb6AZdjxpThGe-hvFT5lULka8_FvOEAiBCNJTRELdxUNQmW-TfIwBKyrFv6yO_JLWAUGBALo3KQg%3D%3D&lsparams=mh%2Cmm%2Cmn%2Cms%2Cmv%2Cmvi%2Cpl%2Cinitcwndbps&lsig=AG3C_xAwRAIgHF9Og-zez6jWsU1Or7NlDwTFDFrzJTeVtkPxxVg-jSYCIB4Kz_wJsnUqOpXEpzRy_AAzKAEgHMPzC-veL6zWq25p',
      mimeType: 'video/webm; codecs="vp9"',
      bitrate: 56444,
      width: 256,
      height: 144,
      initRange: [Object],
      indexRange: [Object],
      lastModified: '1610912532867685',
      contentLength: '965268',
      quality: 'tiny',
      fps: 25,
      qualityLabel: '144p',
      projectionType: 'RECTANGULAR',
      averageBitrate: 54213,
      colorInfo: [Object],
      approxDurationMs: '142440',
    },
    {
      itag: 394,
      url: 'https://rr2---sn-4g5edndz.googlevideo.com/videoplayback?expire=1685401424&ei=8Np0ZPDjNJj91wKJ-5HwCw&ip=2a01%3A4f8%3Ac012%3A39be%3A%3A1&id=o-AOCHH2FcKwgfxr5jVJx9eBL0nII8vu65CGSEjP6WslK8&itag=394&source=youtube&requiressl=yes&mh=FO&mm=31%2C29&mn=sn-4g5edndz%2Csn-4g5lznes&ms=au%2Crdu&mv=m&mvi=2&pl=52&initcwndbps=558750&spc=qEK7Bztc-j52kjIWG6wiySeqe0hg4Ng&vprv=1&svpuc=1&mime=video%2Fmp4&gir=yes&clen=907219&dur=142.440&lmt=1623739508991639&mt=1685379408&fvip=1&keepalive=yes&fexp=24007246&beids=24350017&c=ANDROID&txp=5436432&sparams=expire%2Cei%2Cip%2Cid%2Citag%2Csource%2Crequiressl%2Cspc%2Cvprv%2Csvpuc%2Cmime%2Cgir%2Cclen%2Cdur%2Clmt&sig=AOq0QJ8wRAIgR37xxB1bkJS_uvbKHRIWtEuTCw7NccdZKrPnuHWM9mICICrfkXuzfePrW2zXCSfoWN_qDrmVJXK39Xs2g1Mtoc6f&lsparams=mh%2Cmm%2Cmn%2Cms%2Cmv%2Cmvi%2Cpl%2Cinitcwndbps&lsig=AG3C_xAwRAIgHF9Og-zez6jWsU1Or7NlDwTFDFrzJTeVtkPxxVg-jSYCIB4Kz_wJsnUqOpXEpzRy_AAzKAEgHMPzC-veL6zWq25p',
      mimeType: 'video/mp4; codecs="av01.0.00M.08"',
      bitrate: 53581,
      width: 256,
      height: 144,
      initRange: [Object],
      indexRange: [Object],
      lastModified: '1623739508991639',
      contentLength: '907219',
      quality: 'tiny',
      fps: 25,
      qualityLabel: '144p',
      projectionType: 'RECTANGULAR',
      averageBitrate: 50953,
      colorInfo: [Object],
      approxDurationMs: '142440',
    },
    {
      itag: 597,
      url: 'https://rr2---sn-4g5edndz.googlevideo.com/videoplayback?expire=1685401424&ei=8Np0ZPDjNJj91wKJ-5HwCw&ip=2a01%3A4f8%3Ac012%3A39be%3A%3A1&id=o-AOCHH2FcKwgfxr5jVJx9eBL0nII8vu65CGSEjP6WslK8&itag=597&source=youtube&requiressl=yes&mh=FO&mm=31%2C29&mn=sn-4g5edndz%2Csn-4g5lznes&ms=au%2Crdu&mv=m&mvi=2&pl=52&initcwndbps=558750&spc=qEK7Bztc-j52kjIWG6wiySeqe0hg4Ng&vprv=1&svpuc=1&mime=video%2Fmp4&gir=yes&clen=374775&dur=142.480&lmt=1610912322759995&mt=1685379408&fvip=1&keepalive=yes&fexp=24007246&beids=24350017&c=ANDROID&txp=5432434&sparams=expire%2Cei%2Cip%2Cid%2Citag%2Csource%2Crequiressl%2Cspc%2Cvprv%2Csvpuc%2Cmime%2Cgir%2Cclen%2Cdur%2Clmt&sig=AOq0QJ8wRAIgcrwmH6yDty6CIZYYssFKPsFXf17hPrsf-_FCWNMPmW0CIHleWeHwa7DJY3D_pv1bEowsws-4w-YPsLZx6ZlAy2o_&lsparams=mh%2Cmm%2Cmn%2Cms%2Cmv%2Cmvi%2Cpl%2Cinitcwndbps&lsig=AG3C_xAwRAIgHF9Og-zez6jWsU1Or7NlDwTFDFrzJTeVtkPxxVg-jSYCIB4Kz_wJsnUqOpXEpzRy_AAzKAEgHMPzC-veL6zWq25p',
      mimeType: 'video/mp4; codecs="avc1.4d400b"',
      bitrate: 22488,
      width: 256,
      height: 144,
      initRange: [Object],
      indexRange: [Object],
      lastModified: '1610912322759995',
      contentLength: '374775',
      quality: 'tiny',
      fps: 13,
      qualityLabel: '144p',
      projectionType: 'RECTANGULAR',
      averageBitrate: 21042,
      approxDurationMs: '142480',
    },
    {
      itag: 598,
      url: 'https://rr2---sn-4g5edndz.googlevideo.com/videoplayback?expire=1685401424&ei=8Np0ZPDjNJj91wKJ-5HwCw&ip=2a01%3A4f8%3Ac012%3A39be%3A%3A1&id=o-AOCHH2FcKwgfxr5jVJx9eBL0nII8vu65CGSEjP6WslK8&itag=598&source=youtube&requiressl=yes&mh=FO&mm=31%2C29&mn=sn-4g5edndz%2Csn-4g5lznes&ms=au%2Crdu&mv=m&mvi=2&pl=52&initcwndbps=558750&spc=qEK7Bztc-j52kjIWG6wiySeqe0hg4Ng&vprv=1&svpuc=1&mime=video%2Fwebm&gir=yes&clen=416553&dur=142.480&lmt=1610912322983062&mt=1685379408&fvip=1&keepalive=yes&fexp=24007246&beids=24350017&c=ANDROID&txp=5432434&sparams=expire%2Cei%2Cip%2Cid%2Citag%2Csource%2Crequiressl%2Cspc%2Cvprv%2Csvpuc%2Cmime%2Cgir%2Cclen%2Cdur%2Clmt&sig=AOq0QJ8wRgIhAIFz3P-lYgQzcapLjA7iWEMtCIwJfWZBvVIq7hPMhlFtAiEAm0RlvvoBmaHWrPux4nD4bxFlnhDB4Z6Mbx2kVZtCxs0%3D&lsparams=mh%2Cmm%2Cmn%2Cms%2Cmv%2Cmvi%2Cpl%2Cinitcwndbps&lsig=AG3C_xAwRAIgHF9Og-zez6jWsU1Or7NlDwTFDFrzJTeVtkPxxVg-jSYCIB4Kz_wJsnUqOpXEpzRy_AAzKAEgHMPzC-veL6zWq25p',
      mimeType: 'video/webm; codecs="vp9"',
      bitrate: 24577,
      width: 256,
      height: 144,
      initRange: [Object],
      indexRange: [Object],
      lastModified: '1610912322983062',
      contentLength: '416553',
      quality: 'tiny',
      fps: 13,
      qualityLabel: '144p',
      projectionType: 'RECTANGULAR',
      averageBitrate: 23388,
      colorInfo: [Object],
      approxDurationMs: '142480',
    },
    {
      itag: 139,
      url: 'https://rr2---sn-4g5edndz.googlevideo.com/videoplayback?expire=1685401424&ei=8Np0ZPDjNJj91wKJ-5HwCw&ip=2a01%3A4f8%3Ac012%3A39be%3A%3A1&id=o-AOCHH2FcKwgfxr5jVJx9eBL0nII8vu65CGSEjP6WslK8&itag=139&source=youtube&requiressl=yes&mh=FO&mm=31%2C29&mn=sn-4g5edndz%2Csn-4g5lznes&ms=au%2Crdu&mv=m&mvi=2&pl=52&initcwndbps=558750&spc=qEK7Bztc-j52kjIWG6wiySeqe0hg4Ng&vprv=1&svpuc=1&mime=audio%2Fmp4&gir=yes&clen=870116&dur=142.570&lmt=1610909068117672&mt=1685379408&fvip=1&keepalive=yes&fexp=24007246&beids=24350017&c=ANDROID&txp=5432434&sparams=expire%2Cei%2Cip%2Cid%2Citag%2Csource%2Crequiressl%2Cspc%2Cvprv%2Csvpuc%2Cmime%2Cgir%2Cclen%2Cdur%2Clmt&sig=AOq0QJ8wRAIgJcAaHIBDpUsiyjvfsCrAHbbc-7bDpiZVtuDhtiyXVacCIC5KcP88iV-MRTk9JE1Elml23SFsUK7Ar3HliHgn5bJv&lsparams=mh%2Cmm%2Cmn%2Cms%2Cmv%2Cmvi%2Cpl%2Cinitcwndbps&lsig=AG3C_xAwRAIgHF9Og-zez6jWsU1Or7NlDwTFDFrzJTeVtkPxxVg-jSYCIB4Kz_wJsnUqOpXEpzRy_AAzKAEgHMPzC-veL6zWq25p',
      mimeType: 'audio/mp4; codecs="mp4a.40.5"',
      bitrate: 49857,
      initRange: [Object],
      indexRange: [Object],
      lastModified: '1610909068117672',
      contentLength: '870116',
      quality: 'tiny',
      projectionType: 'RECTANGULAR',
      averageBitrate: 48824,
      audioQuality: 'AUDIO_QUALITY_LOW',
      approxDurationMs: '142570',
      audioSampleRate: '22050',
      audioChannels: 2,
      loudnessDb: 1.6784973,
    },
    {
      itag: 140,
      url: 'https://rr2---sn-4g5edndz.googlevideo.com/videoplayback?expire=1685401424&ei=8Np0ZPDjNJj91wKJ-5HwCw&ip=2a01%3A4f8%3Ac012%3A39be%3A%3A1&id=o-AOCHH2FcKwgfxr5jVJx9eBL0nII8vu65CGSEjP6WslK8&itag=140&source=youtube&requiressl=yes&mh=FO&mm=31%2C29&mn=sn-4g5edndz%2Csn-4g5lznes&ms=au%2Crdu&mv=m&mvi=2&pl=52&initcwndbps=558750&spc=qEK7Bztc-j52kjIWG6wiySeqe0hg4Ng&vprv=1&svpuc=1&mime=audio%2Fmp4&gir=yes&clen=2306965&dur=142.500&lmt=1610909073323527&mt=1685379408&fvip=1&keepalive=yes&fexp=24007246&beids=24350017&c=ANDROID&txp=5432434&sparams=expire%2Cei%2Cip%2Cid%2Citag%2Csource%2Crequiressl%2Cspc%2Cvprv%2Csvpuc%2Cmime%2Cgir%2Cclen%2Cdur%2Clmt&sig=AOq0QJ8wRQIgBTd_rI9TFrOOTXInrJLWJHrB0X5gJKeEj5fmd05XW6gCIQCSeXxIWcTFeGTkSxT3OCVKOfNDJ2MV_BVLbzn-43EIWg%3D%3D&lsparams=mh%2Cmm%2Cmn%2Cms%2Cmv%2Cmvi%2Cpl%2Cinitcwndbps&lsig=AG3C_xAwRAIgHF9Og-zez6jWsU1Or7NlDwTFDFrzJTeVtkPxxVg-jSYCIB4Kz_wJsnUqOpXEpzRy_AAzKAEgHMPzC-veL6zWq25p',
      mimeType: 'audio/mp4; codecs="mp4a.40.2"',
      bitrate: 130415,
      initRange: [Object],
      indexRange: [Object],
      lastModified: '1610909073323527',
      contentLength: '2306965',
      quality: 'tiny',
      projectionType: 'RECTANGULAR',
      averageBitrate: 129513,
      highReplication: true,
      audioQuality: 'AUDIO_QUALITY_MEDIUM',
      approxDurationMs: '142500',
      audioSampleRate: '44100',
      audioChannels: 2,
      loudnessDb: 1.6784973,
    },
    {
      itag: 249,
      url: 'https://rr2---sn-4g5edndz.googlevideo.com/videoplayback?expire=1685401424&ei=8Np0ZPDjNJj91wKJ-5HwCw&ip=2a01%3A4f8%3Ac012%3A39be%3A%3A1&id=o-AOCHH2FcKwgfxr5jVJx9eBL0nII8vu65CGSEjP6WslK8&itag=249&source=youtube&requiressl=yes&mh=FO&mm=31%2C29&mn=sn-4g5edndz%2Csn-4g5lznes&ms=au%2Crdu&mv=m&mvi=2&pl=52&initcwndbps=558750&spc=qEK7Bztc-j52kjIWG6wiySeqe0hg4Ng&vprv=1&svpuc=1&mime=audio%2Fwebm&gir=yes&clen=855200&dur=142.461&lmt=1610909066999735&mt=1685379408&fvip=1&keepalive=yes&fexp=24007246&beids=24350017&c=ANDROID&txp=5432434&sparams=expire%2Cei%2Cip%2Cid%2Citag%2Csource%2Crequiressl%2Cspc%2Cvprv%2Csvpuc%2Cmime%2Cgir%2Cclen%2Cdur%2Clmt&sig=AOq0QJ8wRAIgJYeqMsioOAFVuiAqosJeOmXO1KBjZ0-bq9VcfY2B9NoCIFV80sxYFjzq5_Oice-RoHjjyFZpXSS1DtHENSzNHg_A&lsparams=mh%2Cmm%2Cmn%2Cms%2Cmv%2Cmvi%2Cpl%2Cinitcwndbps&lsig=AG3C_xAwRAIgHF9Og-zez6jWsU1Or7NlDwTFDFrzJTeVtkPxxVg-jSYCIB4Kz_wJsnUqOpXEpzRy_AAzKAEgHMPzC-veL6zWq25p',
      mimeType: 'audio/webm; codecs="opus"',
      bitrate: 51156,
      initRange: [Object],
      indexRange: [Object],
      lastModified: '1610909066999735',
      contentLength: '855200',
      quality: 'tiny',
      projectionType: 'RECTANGULAR',
      averageBitrate: 48024,
      audioQuality: 'AUDIO_QUALITY_LOW',
      approxDurationMs: '142461',
      audioSampleRate: '48000',
      audioChannels: 2,
      loudnessDb: 1.6784973,
    },
    {
      itag: 250,
      url: 'https://rr2---sn-4g5edndz.googlevideo.com/videoplayback?expire=1685401424&ei=8Np0ZPDjNJj91wKJ-5HwCw&ip=2a01%3A4f8%3Ac012%3A39be%3A%3A1&id=o-AOCHH2FcKwgfxr5jVJx9eBL0nII8vu65CGSEjP6WslK8&itag=250&source=youtube&requiressl=yes&mh=FO&mm=31%2C29&mn=sn-4g5edndz%2Csn-4g5lznes&ms=au%2Crdu&mv=m&mvi=2&pl=52&initcwndbps=558750&spc=qEK7Bztc-j52kjIWG6wiySeqe0hg4Ng&vprv=1&svpuc=1&mime=audio%2Fwebm&gir=yes&clen=1129980&dur=142.461&lmt=1610909112092153&mt=1685379408&fvip=1&keepalive=yes&fexp=24007246&beids=24350017&c=ANDROID&txp=5432434&sparams=expire%2Cei%2Cip%2Cid%2Citag%2Csource%2Crequiressl%2Cspc%2Cvprv%2Csvpuc%2Cmime%2Cgir%2Cclen%2Cdur%2Clmt&sig=AOq0QJ8wRgIhANgGZ-PeBrCRFEp3OMnwe5pPotE-QuDj7xg6xwDOQyGzAiEAhzEPL7dhUNXjQmX2C0-dEgLkLsv4M2U5YtqtKsVr-XA%3D&lsparams=mh%2Cmm%2Cmn%2Cms%2Cmv%2Cmvi%2Cpl%2Cinitcwndbps&lsig=AG3C_xAwRAIgHF9Og-zez6jWsU1Or7NlDwTFDFrzJTeVtkPxxVg-jSYCIB4Kz_wJsnUqOpXEpzRy_AAzKAEgHMPzC-veL6zWq25p',
      mimeType: 'audio/webm; codecs="opus"',
      bitrate: 67554,
      initRange: [Object],
      indexRange: [Object],
      lastModified: '1610909112092153',
      contentLength: '1129980',
      quality: 'tiny',
      projectionType: 'RECTANGULAR',
      averageBitrate: 63454,
      audioQuality: 'AUDIO_QUALITY_LOW',
      approxDurationMs: '142461',
      audioSampleRate: '48000',
      audioChannels: 2,
      loudnessDb: 1.6784973,
    },
    {
      itag: 251,
      url: 'https://rr2---sn-4g5edndz.googlevideo.com/videoplayback?expire=1685401424&ei=8Np0ZPDjNJj91wKJ-5HwCw&ip=2a01%3A4f8%3Ac012%3A39be%3A%3A1&id=o-AOCHH2FcKwgfxr5jVJx9eBL0nII8vu65CGSEjP6WslK8&itag=251&source=youtube&requiressl=yes&mh=FO&mm=31%2C29&mn=sn-4g5edndz%2Csn-4g5lznes&ms=au%2Crdu&mv=m&mvi=2&pl=52&initcwndbps=558750&spc=qEK7Bztc-j52kjIWG6wiySeqe0hg4Ng&vprv=1&svpuc=1&mime=audio%2Fwebm&gir=yes&clen=2259306&dur=142.461&lmt=1610909064554237&mt=1685379408&fvip=1&keepalive=yes&fexp=24007246&beids=24350017&c=ANDROID&txp=5432434&sparams=expire%2Cei%2Cip%2Cid%2Citag%2Csource%2Crequiressl%2Cspc%2Cvprv%2Csvpuc%2Cmime%2Cgir%2Cclen%2Cdur%2Clmt&sig=AOq0QJ8wRgIhAMIKtlaATik5cJteq23hY5LMJKrs6PYuVxV9QxL4oMNKAiEAws2t35Y2FOE0pb4ZoLDKCrNTkOMp8ZdOnC5PgtTkrC4%3D&lsparams=mh%2Cmm%2Cmn%2Cms%2Cmv%2Cmvi%2Cpl%2Cinitcwndbps&lsig=AG3C_xAwRAIgHF9Og-zez6jWsU1Or7NlDwTFDFrzJTeVtkPxxVg-jSYCIB4Kz_wJsnUqOpXEpzRy_AAzKAEgHMPzC-veL6zWq25p',
      mimeType: 'audio/webm; codecs="opus"',
      bitrate: 130801,
      initRange: [Object],
      indexRange: [Object],
      lastModified: '1610909064554237',
      contentLength: '2259306',
      quality: 'tiny',
      projectionType: 'RECTANGULAR',
      averageBitrate: 126872,
      audioQuality: 'AUDIO_QUALITY_MEDIUM',
      approxDurationMs: '142461',
      audioSampleRate: '48000',
      audioChannels: 2,
      loudnessDb: 1.6784973,
    },
    {
      itag: 599,
      url: 'https://rr2---sn-4g5edndz.googlevideo.com/videoplayback?expire=1685401424&ei=8Np0ZPDjNJj91wKJ-5HwCw&ip=2a01%3A4f8%3Ac012%3A39be%3A%3A1&id=o-AOCHH2FcKwgfxr5jVJx9eBL0nII8vu65CGSEjP6WslK8&itag=599&source=youtube&requiressl=yes&mh=FO&mm=31%2C29&mn=sn-4g5edndz%2Csn-4g5lznes&ms=au%2Crdu&mv=m&mvi=2&pl=52&initcwndbps=558750&spc=qEK7Bztc-j52kjIWG6wiySeqe0hg4Ng&vprv=1&svpuc=1&mime=audio%2Fmp4&gir=yes&clen=549385&dur=142.570&lmt=1610909097085253&mt=1685379408&fvip=1&keepalive=yes&fexp=24007246&beids=24350017&c=ANDROID&txp=5432434&sparams=expire%2Cei%2Cip%2Cid%2Citag%2Csource%2Crequiressl%2Cspc%2Cvprv%2Csvpuc%2Cmime%2Cgir%2Cclen%2Cdur%2Clmt&sig=AOq0QJ8wRAIgcpFZURaTJMbCYdRU1nkaUkhrFvaOqEd5ijyxKFoqNhoCIGp4rVmMMhlT9WLAZXgml2QyolOm-tjfQcDmMU1s0dUZ&lsparams=mh%2Cmm%2Cmn%2Cms%2Cmv%2Cmvi%2Cpl%2Cinitcwndbps&lsig=AG3C_xAwRAIgHF9Og-zez6jWsU1Or7NlDwTFDFrzJTeVtkPxxVg-jSYCIB4Kz_wJsnUqOpXEpzRy_AAzKAEgHMPzC-veL6zWq25p',
      mimeType: 'audio/mp4; codecs="mp4a.40.5"',
      bitrate: 31900,
      initRange: [Object],
      indexRange: [Object],
      lastModified: '1610909097085253',
      contentLength: '549385',
      quality: 'tiny',
      projectionType: 'RECTANGULAR',
      averageBitrate: 30827,
      audioQuality: 'AUDIO_QUALITY_ULTRALOW',
      approxDurationMs: '142570',
      audioSampleRate: '22050',
      audioChannels: 2,
      loudnessDb: 1.6784973,
    },
    {
      itag: 600,
      url: 'https://rr2---sn-4g5edndz.googlevideo.com/videoplayback?expire=1685401424&ei=8Np0ZPDjNJj91wKJ-5HwCw&ip=2a01%3A4f8%3Ac012%3A39be%3A%3A1&id=o-AOCHH2FcKwgfxr5jVJx9eBL0nII8vu65CGSEjP6WslK8&itag=600&source=youtube&requiressl=yes&mh=FO&mm=31%2C29&mn=sn-4g5edndz%2Csn-4g5lznes&ms=au%2Crdu&mv=m&mvi=2&pl=52&initcwndbps=558750&spc=qEK7Bztc-j52kjIWG6wiySeqe0hg4Ng&vprv=1&svpuc=1&mime=audio%2Fwebm&gir=yes&clen=578983&dur=142.461&lmt=1610909085003530&mt=1685379408&fvip=1&keepalive=yes&fexp=24007246&beids=24350017&c=ANDROID&txp=5432434&sparams=expire%2Cei%2Cip%2Cid%2Citag%2Csource%2Crequiressl%2Cspc%2Cvprv%2Csvpuc%2Cmime%2Cgir%2Cclen%2Cdur%2Clmt&sig=AOq0QJ8wRQIgTEwHgxUFECVHUFWF5W62Bnsxd3KUYoa3Z6rONmsiN08CIQD_B1P4rBcZ3xDwG00AahBIY7XNdgA5bMTNH8mYJO8ipw%3D%3D&lsparams=mh%2Cmm%2Cmn%2Cms%2Cmv%2Cmvi%2Cpl%2Cinitcwndbps&lsig=AG3C_xAwRAIgHF9Og-zez6jWsU1Or7NlDwTFDFrzJTeVtkPxxVg-jSYCIB4Kz_wJsnUqOpXEpzRy_AAzKAEgHMPzC-veL6zWq25p',
      mimeType: 'audio/webm; codecs="opus"',
      bitrate: 35121,
      initRange: [Object],
      indexRange: [Object],
      lastModified: '1610909085003530',
      contentLength: '578983',
      quality: 'tiny',
      projectionType: 'RECTANGULAR',
      averageBitrate: 32513,
      audioQuality: 'AUDIO_QUALITY_ULTRALOW',
      approxDurationMs: '142461',
      audioSampleRate: '48000',
      audioChannels: 2,
      loudnessDb: 1.6784973,
    },
  ],
};
import * as fs from 'fs';

@Injectable()
export class YoutubeService {
  private readonly logger = new Logger(YoutubeService.name);
  private readonly options: IYoutubeOptions;
  private readonly youtubeApiUrl = 'https://yt-api.p.rapidapi.com/dl';

  constructor(
    private readonly httpService: HttpService,
    private readonly configService: ConfigService,
    private readonly conversionService: ConversionService,
  ) {
    this.options = {
      params: {
        id: null,
      },
      headers: {
        'X-RapidAPI-Host': 'yt-api.p.rapidapi.com',
        'X-RapidAPI-Key': this.configService.get('RAPID_API_V4'),
      },
    };
  }

  async downloadShorts(url: string, ctx: Context) {
    const extraReplyOptions = {
      reply_to_message_id: ctx.message.message_id,
    };
    const { pathname } = new URL(url);

    this.options.params.id = pathname.split('/').at(-1);

    try {
      const { data } = await firstValueFrom(
        this.httpService.get(this.youtubeApiUrl, this.options).pipe(
          catchError((err) => {
            this.logger.error(err);
            return of(err.response.statusText);
          }),
        ),
      );

      await ctx.replyWithVideo(data.formats.at(-1).url, extraReplyOptions);
    } catch (error) {
      await ctx.reply(error.message, extraReplyOptions);
    }
  }

  async downloadMusic(url: string, ctx: Context) {
    const extraReplyOptions = {
      reply_to_message_id: ctx.message.message_id,
    };

    const { searchParams } = new URL(url);

    this.options.params.id = searchParams.get('v');

    try {
      const { data } = await firstValueFrom(
        this.httpService.get(this.youtubeApiUrl, this.options).pipe(
          catchError((err) => {
            this.logger.error(err);
            return of(err.response.statusText);
          }),
        ),
      );

      const url = data.formats.at(-1).url;

      const path = await this.conversionService.converseVideoToAudio(url);

      await ctx.replyWithAudio({ source: path }, extraReplyOptions);
    } catch (error) {
      await ctx.reply(error.message, extraReplyOptions);
    }
  }
}
